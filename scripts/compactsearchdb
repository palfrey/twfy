#! /usr/bin/perl -w
# compactsearchdb. Compacts the Xapian search database
#
# $Id: compactsearchdb,v 1.2 2008-02-15 19:38:53 matthew Exp $

use strict;

use FindBin;
use File::Path;
use lib "$FindBin::Bin/../../perllib";

use mySociety::Config;
mySociety::Config::set_file('../conf/general');

my $xapian = mySociety::Config::get('XAPIANDB');

chdir $xapian . '/../';
rmtree('searchdb-compacted');
system('xapian-compact searchdb/ searchdb-compacted/ >/dev/null');
rmtree('searchdb-previous');
rename 'searchdb', 'searchdb-previous';
rename 'searchdb-compacted', 'searchdb';

